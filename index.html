
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FR SYSTEM — Misure</title>
  <style>
    :root{
      --bg:#F5F5F7;
      --surface:#FFFFFF;
      --text:#1D3557;
      --muted:rgba(29,53,87,.72);
      --border:rgba(29,53,87,.14);
      --shadow:0 10px 28px rgba(29,53,87,.08);

      --primary:#1D3557;
      --accent:#26A69A;

      --ok:#26A69A;
      --warn:#FB8C00;
      --bad:#E53935;

      --r:18px;
      --r2:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .wrap{max-width:980px;margin:0 auto;padding:14px;min-height:100%;display:flex;flex-direction:column;gap:12px}

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px;background:var(--surface);border:1px solid var(--border);
      border-radius:var(--r);box-shadow:var(--shadow);flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{width:120px;max-width:38vw;height:auto;display:block}
    .brandText{min-width:0}
    .brandTitle{font-weight:1000;letter-spacing:.2px;font-size:16px;line-height:1.1}
    .brandSub{margin-top:4px;font-size:12px;color:var(--muted);line-height:1.35}

    .pill{
      font-size:12px;padding:7px 12px;border-radius:999px;border:1px solid var(--border);
      background:#fff;color:var(--muted);font-weight:900;white-space:nowrap;
    }
    .pill.ok{border-color:rgba(38,166,154,.35);background:rgba(38,166,154,.14);color:var(--ok)}
    .pill.bad{border-color:rgba(229,57,53,.35);background:rgba(229,57,53,.12);color:var(--bad)}
    .pill.warn{border-color:rgba(251,140,0,.35);background:rgba(251,140,0,.14);color:var(--warn)}

    .card{
      width:100%;
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .center{flex:1;display:flex;align-items:center;justify-content:center}
    .hero{max-width:820px}
    .heroHead{padding:18px 18px 12px}
    .heroTitle{font-weight:1000;font-size:22px;letter-spacing:.2px}
    .heroDesc{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.4}
    .divider{height:1px;background:var(--border)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:16px 18px 8px}
    @media (max-width:760px){.grid2{grid-template-columns:1fr}}
    .btn{
      display:block;text-decoration:none;color:inherit;border:1px solid var(--border);
      border-radius:var(--r2);background:#fff;padding:14px 14px;
      transition:transform .04s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
      cursor:pointer;
    }
    .btn:active{transform:translateY(1px)}
    .btn:hover{background:rgba(29,53,87,.03)}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.primary:hover{background:#16304d}
    .btn.ghost{background:#fff}
    .btn.big{padding:16px}
    .btnTitle{font-weight:1000;letter-spacing:.2px;font-size:16px}
    .btnDesc{margin-top:6px;font-size:12px;color:rgba(245,245,247,.88)}
    .btn.ghost .btnDesc{color:var(--muted)}
    .btn.disabled{opacity:.45;pointer-events:none}

    .note{
      margin:8px 18px 18px;font-size:12px;color:var(--muted);font-weight:900;
      padding:10px 12px;border-radius:var(--r2);border:1px solid var(--border);background:#fff;
    }
    .note.ok{border-color:rgba(38,166,154,.35);background:rgba(38,166,154,.12);color:var(--ok)}
    .note.warn{border-color:rgba(251,140,0,.35);background:rgba(251,140,0,.12);color:rgba(29,53,87,.9)}
    .note.bad{border-color:rgba(229,57,53,.35);background:rgba(229,57,53,.12);color:rgba(29,53,87,.95)}

    .foot{text-align:center;padding:6px 0 2px}
    .muted{color:var(--muted);font-size:12px;font-weight:800}

    /* modules */
    .panel{padding:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .kbtn{
      appearance:none;border:1px solid var(--border);background:#fff;color:var(--text);
      padding:10px 12px;border-radius:var(--r2);font-weight:1000;cursor:pointer;
      transition:transform .04s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
    }
    .kbtn:active{transform:translateY(1px)}
    .kbtn:hover{background:rgba(29,53,87,.04)}
    .kbtn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .kbtn.primary:hover{background:#16304d}
    .kbtn.danger{color:var(--bad);border-color:rgba(229,57,53,.35)}
    .kbtn.danger:hover{background:rgba(229,57,53,.10)}
    .kbtn:disabled{opacity:.45;cursor:not-allowed}

    .viewer{
      position:relative;width:100%;background:#0b0f14;overflow:hidden;
      border-top:1px solid var(--border);border-bottom:1px solid var(--border);
      height:min(60vh,560px);min-height:360px;
    }
    @media (min-width:860px){.viewer{height:520px}}
    .overlay2d{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}
    .hidden{display:none !important}
    .small{font-size:12px;font-weight:900;color:var(--muted)}

    /* camera video */
    video.cam{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      background:#0b0f14;
    }

    /* HUD */
    .hud{padding:12px 14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
    .hudBox{flex:1 1 260px;border:1px solid var(--border);background:#fff;border-radius:var(--r2);padding:10px 12px;}
    .hudLabel{font-size:12px;color:var(--muted);font-weight:1000;letter-spacing:.15px}
    .hudValue{margin-top:4px;font-size:18px;font-weight:1000}
    .hudSub{margin-top:4px;font-size:12px;color:var(--muted);font-weight:900;line-height:1.35}
    .list{margin:0;padding-left:18px;font-weight:900}
  </style>
</head>

<body>
<div class="wrap">
  <header class="topbar">
    <div class="brand">
      <img class="logo" src="logo.png" alt="FR Color" onerror="this.style.display='none'">
      <div class="brandText">
        <div class="brandTitle">FR SYSTEM</div>
        <div class="brandSub" id="subTitle">Seleziona la modalità di misurazione</div>
      </div>
    </div>
    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
      <span class="pill" id="httpsPill">HTTPS: —</span>
      <span class="pill" id="camPill">CAM: —</span>
      <span class="pill" id="arPillTop">AR: —</span>
      <button class="kbtn hidden" id="btnHome">Home</button>
    </div>
  </header>

  <!-- HOME -->
  <main class="center" id="homeView">
    <section class="card hero">
      <div class="heroHead">
        <div class="heroTitle">Misure</div>
        <div class="heroDesc">
          Telemetro: indicativo con camera + sensori. AR: prova misura reale (solo dispositivi compatibili).
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <button class="btn big ghost" id="goTele">
          <div class="btnTitle">Telemetro</div>
          <div class="btnDesc">Camera + sensori • Indicativo • Sempre disponibile</div>
        </button>

        <button class="btn big primary" id="goAR">
          <div class="btnTitle">AR Misure</div>
          <div class="btnDesc">Prova WebXR AR • Se non compatibile resta solo camera</div>
        </button>
      </div>

      <div class="note" id="compatNote">Controllo compatibilità e camera…</div>
    </section>
  </main>

  <!-- TELEMETRO VIEW -->
  <section class="card hidden" id="teleView">
    <div class="panel">
      <button class="kbtn primary" id="tStartCam">Avvia Fotocamera</button>
      <button class="kbtn" id="tEnableSensors">Attiva sensori</button>
      <button class="kbtn" id="tBase" disabled>Tap Base</button>
      <button class="kbtn" id="tTop" disabled>Tap Alto</button>
      <button class="kbtn" id="tReset" disabled>Reset</button>
      <button class="kbtn" id="tSave" disabled>Salva</button>
      <button class="kbtn danger" id="tClearHistory">Azzera storico</button>
      <span class="pill warn" id="tPill">Stato: —</span>
    </div>

    <div class="panel" style="padding-top:0;">
      <div class="small">Altezza telefono da terra (cm)</div>
      <input class="kbtn" id="tHeight" type="number" min="50" max="250" step="1" value="150" style="width:220px;" />
      <span class="small">Consiglio: imposta una volta e lascia fisso</span>
    </div>

    <div class="viewer" id="tViewer">
      <video class="cam" id="tVideo" playsinline muted autoplay></video>
      <canvas class="overlay2d" id="tHud"></canvas>
    </div>

    <div class="hud">
      <div class="hudBox">
        <div class="hudLabel">Risultato</div>
        <div class="hudValue" id="tOutMain">—</div>
        <div class="hudSub" id="tOutSub">
          1) Avvia Fotocamera  2) Attiva sensori  3) Punta BASE → Tap Base  4) Punta ALTO → Tap Alto
        </div>
      </div>

      <div class="hudBox">
        <div class="hudLabel" id="tHistLabel">Storico misure (0/10)</div>
        <ol class="list" id="tHistList"></ol>
      </div>
    </div>

    <div class="panel">
      <div class="note warn" style="margin:0; width:100%;">
        Telemetro = trigonometria. Su 20–30 m è normale avere errore grande (per te ok).
      </div>
    </div>
  </section>

  <!-- AR VIEW -->
  <section class="card hidden" id="arView">
    <div class="panel">
      <button class="kbtn primary" id="arStartCam">Avvia Fotocamera</button>
      <button class="kbtn primary" id="arTryWebXR">Prova AR (WebXR)</button>
      <button class="kbtn" id="arReset" disabled>Reset</button>
      <button class="kbtn" id="arSave" disabled>Salva</button>
      <button class="kbtn danger" id="arClearHistory">Azzera storico</button>

      <span class="pill" id="arPill">AR: —</span>
      <span class="pill" id="arModePill">Modalità: Distanza</span>

      <select class="kbtn" id="arModeSel" style="padding:10px 12px;">
        <option value="distance" selected>Distanza</option>
        <option value="area">Area (rettangolo)</option>
      </select>
    </div>

    <div class="viewer" id="arViewer">
      <video class="cam" id="arVideo" playsinline muted autoplay></video>
      <canvas class="overlay2d" id="arHud"></canvas>
    </div>

    <div class="hud">
      <div class="hudBox">
        <div class="hudLabel">Risultato</div>
        <div class="hudValue" id="arOutMain">—</div>
        <div class="hudSub" id="arOutSub">
          Avvia Fotocamera per mirino. Poi “Prova AR (WebXR)”: se supportato attiva misure reali.
        </div>
      </div>

      <div class="hudBox">
        <div class="hudLabel" id="arHistLabel">Storico misure (0/10)</div>
        <ol class="list" id="arHistList"></ol>
      </div>
    </div>

    <div class="panel">
      <div class="note warn" style="margin:0; width:100%;">
        Se WebXR AR non è supportato, qui vedrai SOLO camera (senza misura 3D reale).
      </div>
    </div>
  </section>

  <footer class="foot">
    <span class="muted">FR Color • Stile e colori ufficiali</span>
  </footer>
</div>

<script>
/* ========= ROUTER ========= */
const homeView = document.getElementById('homeView');
const arView   = document.getElementById('arView');
const teleView = document.getElementById('teleView');
const btnHome  = document.getElementById('btnHome');
const subTitle = document.getElementById('subTitle');

function show(view){
  homeView.classList.add('hidden');
  arView.classList.add('hidden');
  teleView.classList.add('hidden');
  btnHome.classList.remove('hidden');

  if(view==='home'){
    homeView.classList.remove('hidden');
    btnHome.classList.add('hidden');
    subTitle.textContent = 'Seleziona la modalità di misurazione';
  }
  if(view==='tele'){
    teleView.classList.remove('hidden');
    subTitle.textContent = 'Telemetro • Camera + sensori • Indicativo';
  }
  if(view==='ar'){
    arView.classList.remove('hidden');
    subTitle.textContent = 'AR Misure • Camera + tentativo WebXR';
  }
}
btnHome.addEventListener('click', () => show('home'));
document.getElementById('goTele').addEventListener('click', () => show('tele'));
document.getElementById('goAR').addEventListener('click', () => show('ar'));

/* ========= STATUS PILLS ========= */
const httpsPill = document.getElementById('httpsPill');
const camPill   = document.getElementById('camPill');
const arPillTop = document.getElementById('arPillTop');
const compatNote= document.getElementById('compatNote');

function setPill(el, text, kind){
  el.textContent = text;
  el.classList.remove('ok','warn','bad');
  if(kind) el.classList.add(kind);
}

const httpsOk = (location.protocol === 'https:' || location.hostname === 'localhost') && window.isSecureContext;
setPill(httpsPill, httpsOk ? 'HTTPS: OK' : 'HTTPS: NO', httpsOk ? 'ok' : 'bad');

/* ========= CAMERA (shared) ========= */
let camStream = null;

async function startCamera(videoEl){
  if(!httpsOk) throw new Error('HTTPS richiesto');
  if(!navigator.mediaDevices?.getUserMedia) throw new Error('getUserMedia non supportato');

  // se già aperta, riusa stream
  if(camStream){
    videoEl.srcObject = camStream;
    await videoEl.play().catch(()=>{});
    return;
  }
  camStream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: { ideal: "environment" } },
    audio: false
  });
  videoEl.srcObject = camStream;
  await videoEl.play().catch(()=>{});
  setPill(camPill,'CAM: OK','ok');
}

function stopCamera(){
  if(!camStream) return;
  camStream.getTracks().forEach(t => t.stop());
  camStream = null;
  setPill(camPill,'CAM: OFF','warn');
}

/* ========= WEBXR SUPPORT CHECK ========= */
async function checkWebXRAR(){
  if(!httpsOk) return false;
  if(!('xr' in navigator)) return false;
  try{
    return await navigator.xr.isSessionSupported('immersive-ar');
  }catch{
    return false;
  }
}

(async () => {
  setPill(camPill,'CAM: —','warn');
  const arOk = await checkWebXRAR();
  setPill(arPillTop, arOk ? 'AR: possibile' : 'AR: non disponibile', arOk ? 'ok' : 'warn');
  compatNote.textContent = arOk
    ? 'WebXR AR sembra disponibile su questo dispositivo. La camera si apre con il pulsante.'
    : 'WebXR AR non disponibile qui. Telemetro funziona comunque (camera + sensori).';
  compatNote.className = 'note ' + (arOk ? 'ok' : 'warn');
})();

/* ========= TELEMETRO MODULE ========= */
(() => {
  const tVideo = document.getElementById('tVideo');
  const tHud   = document.getElementById('tHud');
  const btnCam = document.getElementById('tStartCam');
  const btnSen = document.getElementById('tEnableSensors');
  const btnBase= document.getElementById('tBase');
  const btnTop = document.getElementById('tTop');
  const btnReset=document.getElementById('tReset');
  const btnSave=document.getElementById('tSave');
  const btnClear=document.getElementById('tClearHistory');
  const pill   = document.getElementById('tPill');
  const inH    = document.getElementById('tHeight');
  const outMain= document.getElementById('tOutMain');
  const outSub = document.getElementById('tOutSub');
  const histLbl= document.getElementById('tHistLabel');
  const histList=document.getElementById('tHistList');

  const T = { pitchDeg:null, basePitch:null, topPitch:null, last:null, history:[] };

  function set(text,kind){
    pill.textContent = text;
    pill.classList.remove('ok','warn','bad');
    if(kind) pill.classList.add(kind);
  }
  function rad(d){ return d*Math.PI/180; }
  function fmt(m){
    if(!Number.isFinite(m)) return '—';
    if(m>=10) return `${m.toFixed(2)} m`;
    if(m>=1) return `${m.toFixed(3)} m`;
    return `${(m*100).toFixed(1)} cm`;
  }
  function updateHistory(){
    histList.innerHTML='';
    T.history.forEach(x=>{const li=document.createElement('li'); li.textContent=x; histList.appendChild(li);});
    histLbl.textContent = `Storico misure (${T.history.length}/10)`;
  }
  function addHistory(x){
    if(T.history.length===10) T.history=[];
    T.history.push(x);
    updateHistory();
  }
  function drawCrosshair(){
    const dpr = window.devicePixelRatio || 1;
    const rect = tVideo.getBoundingClientRect();
    tHud.width  = Math.max(1, Math.round(rect.width * dpr));
    tHud.height = Math.max(1, Math.round(rect.height * dpr));
    const ctx = tHud.getContext('2d');
    ctx.clearRect(0,0,tHud.width,tHud.height);
    const cx = tHud.width/2, cy = tHud.height/2;
    ctx.strokeStyle='rgba(245,245,247,.92)';
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(cx-18,cy); ctx.lineTo(cx+18,cy);
    ctx.moveTo(cx,cy-18); ctx.lineTo(cx,cy+18);
    ctx.stroke();
  }

  window.addEventListener('resize', drawCrosshair);

  function handleOri(e){
    if(typeof e.beta !== 'number') return;
    T.pitchDeg = -e.beta; // su positivo
  }

  async function enableSensors(){
    try{
      if(typeof DeviceOrientationEvent !== 'undefined' &&
         typeof DeviceOrientationEvent.requestPermission === 'function'){
        const res = await DeviceOrientationEvent.requestPermission();
        if(res !== 'granted') throw new Error('Permission denied');
      }
      window.addEventListener('deviceorientation', handleOri, true);
      set('Sensori: OK','ok');
      btnBase.disabled=false;
      btnTop.disabled=false;
      btnReset.disabled=false;
      outSub.textContent='Sensori attivi. Punta BASE → Tap Base. Poi punta ALTO → Tap Alto.';
    }catch{
      set('Sensori: KO','bad');
      outSub.textContent='Non riesco ad attivare i sensori. Controlla permessi “Movimento” (se presenti).';
    }
  }

  function compute(){
    const hCm = parseFloat(inH.value);
    const h = (Number.isFinite(hCm) && hCm>0) ? (hCm/100) : 1.5;
    if(T.basePitch==null || T.topPitch==null) return;

    const tanA = Math.tan(Math.abs(rad(T.basePitch)));
    if(!Number.isFinite(tanA) || tanA < 1e-4){
      outMain.textContent='Errore';
      outSub.textContent='Angolo BASE troppo orizzontale. Punta più in basso e ritappa.';
      return;
    }
    const D = h / tanA;
    const H = h + D * Math.tan(rad(T.topPitch));

    T.last = {D,H};
    outMain.textContent = `Distanza: ${fmt(D)} • Altezza: ${fmt(H)}`;
    outSub.textContent = `Base: ${T.basePitch.toFixed(1)}° • Alto: ${T.topPitch.toFixed(1)}° • h: ${(h*100).toFixed(0)} cm`;
    btnSave.disabled=false;
  }

  function reset(){
    T.basePitch=null; T.topPitch=null; T.last=null;
    btnSave.disabled=true;
    outMain.textContent='—';
    outSub.textContent='Punta BASE → Tap Base. Poi punta ALTO → Tap Alto.';
  }

  btnCam.addEventListener('click', async () => {
    try{
      await startCamera(tVideo);
      set('Camera: OK','ok');
      drawCrosshair();
    }catch(err){
      set('Camera: KO','bad');
      outSub.textContent = `Camera non disponibile: ${err.message}`;
    }
  });

  btnSen.addEventListener('click', enableSensors);

  btnBase.addEventListener('click', () => {
    if(T.pitchDeg==null){
      outSub.textContent='Prima “Attiva sensori”.';
      return;
    }
    T.basePitch = T.pitchDeg;
    outSub.textContent = `BASE salvata (${T.basePitch.toFixed(1)}°). Ora punta ALTO → Tap Alto.`;
    compute();
  });

  btnTop.addEventListener('click', () => {
    if(T.pitchDeg==null){
      outSub.textContent='Prima “Attiva sensori”.';
      return;
    }
    T.topPitch = T.pitchDeg;
    outSub.textContent = `ALTO salvato (${T.topPitch.toFixed(1)}°).`;
    compute();
  });

  btnReset.addEventListener('click', reset);

  btnSave.addEventListener('click', () => {
    if(!T.last) return;
    addHistory(`Telemetro — D: ${fmt(T.last.D)} • H: ${fmt(T.last.H)}`);
    btnSave.disabled=true;
    outSub.textContent='Salvato ✅';
  });

  btnClear.addEventListener('click', () => { T.history=[]; updateHistory(); });

  // init
  set('Stato: pronto','warn');
  updateHistory();
  drawCrosshair();
})();

/* ========= AR MODULE (camera always + try WebXR) ========= */
(() => {
  const arVideo = document.getElementById('arVideo');
  const arHud   = document.getElementById('arHud');
  const btnCam  = document.getElementById('arStartCam');
  const btnTry  = document.getElementById('arTryWebXR');
  const btnReset= document.getElementById('arReset');
  const btnSave = document.getElementById('arSave');
  const btnClear= document.getElementById('arClearHistory');
  const pillAR  = document.getElementById('arPill');
  const pillMode= document.getElementById('arModePill');
  const modeSel = document.getElementById('arModeSel');
  const outMain = document.getElementById('arOutMain');
  const outSub  = document.getElementById('arOutSub');
  const histLbl = document.getElementById('arHistLabel');
  const histList= document.getElementById('arHistList');

  const A = {
    webxr:false,
    history:[],
    // placeholders: se WebXR non parte non facciamo finta di misurare
  };

  function setPillLocal(text, kind){ setPill(pillAR,text,kind); }
  function setResult(m,s){ outMain.textContent=m; outSub.textContent=s||''; }
  function updateHistory(){
    histList.innerHTML='';
    A.history.forEach(x=>{const li=document.createElement('li'); li.textContent=x; histList.appendChild(li);});
    histLbl.textContent = `Storico misure (${A.history.length}/10)`;
  }
  function addHistory(x){
    if(A.history.length===10) A.history=[];
    A.history.push(x);
    updateHistory();
  }
  function drawCrosshair(){
    const dpr = window.devicePixelRatio || 1;
    const rect = arVideo.getBoundingClientRect();
    arHud.width  = Math.max(1, Math.round(rect.width * dpr));
    arHud.height = Math.max(1, Math.round(rect.height * dpr));
    const ctx = arHud.getContext('2d');
    ctx.clearRect(0,0,arHud.width,arHud.height);
    const cx = arHud.width/2, cy = arHud.height/2;
    ctx.strokeStyle='rgba(245,245,247,.92)';
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(cx-18,cy); ctx.lineTo(cx+18,cy);
    ctx.moveTo(cx,cy-18); ctx.lineTo(cx,cy+18);
    ctx.stroke();
  }
  window.addEventListener('resize', drawCrosshair);

  btnCam.addEventListener('click', async () => {
    try{
      await startCamera(arVideo);
      setPillLocal('AR: camera OK','ok');
      drawCrosshair();
      setResult('—','Camera attiva. Ora prova “Prova AR (WebXR)”.');
    }catch(err){
      setPillLocal('AR: camera KO','bad');
      setResult('Errore camera', err.message);
    }
  });

  btnTry.addEventListener('click', async () => {
    // qui NON invento misure: se WebXR non parte, lo diciamo e basta.
    const ok = await checkWebXRAR();
    if(!ok){
      setPillLocal('AR: non supportato','warn');
      setResult('AR non disponibile','Questo dispositivo/browser non supporta WebXR AR. Usa Telemetro.');
      return;
    }
    setPillLocal('AR: supporto OK','ok');
    setResult('AR supportato','WebXR AR disponibile: qui si integra la misura reale A→B (step successivo).');
    // Nota: implementare WebXR hit-test + distance come modulo completo è il prossimo step.
    // Prima dovevamo risolvere “camera non si apre”.
  });

  btnReset.addEventListener('click', () => {
    setResult('—','Reset fatto.');
    btnSave.disabled = true;
  });

  btnSave.addEventListener('click', () => {
    // placeholder: in AR reale salveremo le misure
    addHistory('AR — (misura da implementare)');
    btnSave.disabled = true;
  });

  btnClear.addEventListener('click', () => { A.history=[]; updateHistory(); });

  modeSel.addEventListener('change', () => {
    pillMode.textContent = `Modalità: ${modeSel.value === 'distance' ? 'Distanza' : 'Area'}`;
  });

  // init
  setPillLocal('AR: —','warn');
  pillMode.textContent = 'Modalità: Distanza';
  updateHistory();
  drawCrosshair();
})();
show('home');
</script>
</body>
</html>
